<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AQ7 FAV">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0a">
    <title>AQ7 FAV</title>
    <link rel="manifest" href="#" id="manifestLink">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --red: #FF2222;
            --red-dim: #CC0000;
            --bg: #0a0a0a;
            --text: #ffffff;
            --muted: #888;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            overscroll-behavior: none;
        }

        /* HEADER */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: calc(var(--safe-top) + 12px) 16px 12px;
            background: rgba(10,10,10,0.97);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,34,34,0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.6rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--red), var(--red-dim));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right { display: flex; align-items: center; gap: 10px; }

        .count-badge {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            color: var(--red);
            background: rgba(255,34,34,0.1);
            border: 1px solid rgba(255,34,34,0.3);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .mode-toggle {
            display: flex;
            background: rgba(20,20,20,0.9);
            padding: 4px;
            border-radius: 30px;
            border: 1px solid rgba(255,34,34,0.15);
        }

        .mode-btn {
            padding: 6px 14px;
            background: transparent;
            border: none;
            border-radius: 30px;
            color: var(--muted);
            font-family: 'Outfit', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s, background 0.2s;
        }

        .mode-btn.active { background: rgba(255,34,34,0.2); color: var(--red); }

        /* GRID */
        .grid-container { padding: 3px; }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
        }

        .video-thumb {
            position: relative;
            aspect-ratio: 9/16;
            background: #111;
            overflow: hidden;
            cursor: pointer;
            -webkit-user-select: none;
            user-select: none;
        }

        .thumb-bg {
            position: absolute;
            inset: 0;
            background: linear-gradient(160deg, #1c1c1c 0%, #0d0d0d 100%);
        }

        .thumb-img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumb-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 55%, rgba(0,0,0,0.65) 100%);
        }

        .thumb-num {
            position: absolute;
            bottom: 5px;
            left: 6px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.55rem;
            color: rgba(255,34,34,0.9);
            z-index: 2;
        }

        .thumb-play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 32px;
            height: 32px;
            background: rgba(0,0,0,0.4);
            border: 1.5px solid rgba(255,34,34,0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .thumb-play-icon::after {
            content: '';
            width: 0; height: 0;
            border-left: 9px solid var(--red);
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            margin-left: 2px;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.open { display: flex; }

        .modal-header {
            position: absolute;
            top: 0; left: 0; right: 0;
            padding: calc(var(--safe-top) + 10px) 16px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(180deg, rgba(0,0,0,0.85) 0%, transparent 100%);
            z-index: 10;
        }

        .modal-close {
            width: 38px; height: 38px;
            background: rgba(20,20,20,0.85);
            border: 1px solid rgba(255,34,34,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--red);
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            color: var(--red);
        }

        .modal-counter {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            color: var(--muted);
            background: rgba(20,20,20,0.85);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 4px 10px;
            border-radius: 20px;
        }

        /* Video wrapper — simple, no stacking */
        .modal-video-wrap {
            position: relative;
            width: 100%;
            max-width: 420px;
            padding: 0 8px;
        }

        #modalVideo {
            width: 100%;
            max-height: calc(100dvh - 160px);
            max-height: calc(100vh - 160px);
            object-fit: contain;
            border-radius: 10px;
            display: block;
        }

        /* Tap overlay */
        .tap-hint {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s;
        }

        .tap-hint.show { opacity: 1; pointer-events: all; }

        .tap-circle {
            width: 62px; height: 62px;
            background: rgba(0,0,0,0.55);
            border: 2px solid var(--red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tap-circle::after { content: '▶'; color: var(--red); font-size: 1.3rem; margin-left: 3px; }
        .tap-circle.paused::after { content: '⏸'; margin-left: 0; }

        /* Progress */
        .progress-wrap {
            position: absolute;
            bottom: 0; left: 8px; right: 8px;
            height: 3px;
            background: rgba(255,255,255,0.12);
            border-radius: 0 0 10px 10px;
            overflow: hidden;
            pointer-events: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--red), var(--red-dim));
            width: 0%;
        }

        /* Nav */
        .nav-row {
            position: absolute;
            bottom: calc(var(--safe-bottom) + 14px);
            left: 0; right: 0;
            display: flex;
            justify-content: center;
            gap: 24px;
            z-index: 10;
        }

        .nav-btn {
            width: 50px; height: 50px;
            background: rgba(15,15,15,0.92);
            border: 1px solid rgba(255,34,34,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--red);
            font-size: 1.4rem;
            transition: background 0.15s, transform 0.1s;
        }

        .nav-btn:active { background: rgba(255,34,34,0.25); transform: scale(0.9); }
        .nav-btn:disabled { opacity: 0.2; pointer-events: none; }

        /* Install */
        .install-banner {
            position: fixed;
            bottom: calc(var(--safe-bottom) + 10px);
            left: 10px; right: 10px;
            background: rgba(18,18,18,0.97);
            border: 1px solid rgba(255,34,34,0.3);
            border-radius: 16px;
            padding: 14px 16px;
            z-index: 500;
            display: none;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        .install-banner.show { display: flex; }

        .install-icon {
            width: 44px; height: 44px;
            background: linear-gradient(135deg, var(--red), var(--red-dim));
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.6rem; color: #fff; font-weight: 900;
            flex-shrink: 0;
        }

        .install-text { flex: 1; }
        .install-text strong { display: block; font-size: 0.85rem; }
        .install-text span { font-size: 0.75rem; color: var(--muted); }

        .install-btn {
            background: linear-gradient(135deg, var(--red), var(--red-dim));
            color: #fff; border: none;
            padding: 8px 16px; border-radius: 20px;
            font-family: 'Outfit', sans-serif;
            font-weight: 700; font-size: 0.8rem;
            cursor: pointer; flex-shrink: 0;
        }

        .install-close {
            position: absolute; top: 8px; right: 8px;
            background: none; border: none;
            color: var(--muted); font-size: 1rem; cursor: pointer; padding: 4px;
        }

        #sentinel { height: 1px; }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">AQ7 FAV</div>
    <div class="header-right">
        <span class="count-badge" id="totalCount">218 VIDS</span>
        <div class="mode-toggle">
            <button class="mode-btn active" id="replayBtn" onclick="setMode('replay')">↻</button>
            <button class="mode-btn" id="autoNextBtn" onclick="setMode('autoNext')">▶▶</button>
        </div>
    </div>
</div>

<div class="grid-container">
    <div class="video-grid" id="videoGrid"></div>
    <div id="sentinel"></div>
</div>

<!-- MODAL — one clean video element, no tricks -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal-header">
        <button class="modal-close" onclick="closeModal()">✕</button>
        <span class="modal-title">AQ7 FAV</span>
        <span class="modal-counter" id="modalCounter">#001</span>
    </div>

    <div class="modal-video-wrap" id="modalVideoWrap">
        <video
            id="modalVideo"
            playsinline
            webkit-playsinline
            preload="auto"
        ></video>

        <div class="tap-hint show" id="tapHint" onclick="togglePlay()">
            <div class="tap-circle" id="tapCircle"></div>
        </div>

        <div class="progress-wrap">
            <div class="progress-bar" id="progressBar"></div>
        </div>
    </div>

    <div class="nav-row">
        <button class="nav-btn" id="prevBtn" onclick="navigate(-1)">‹</button>
        <button class="nav-btn" id="nextBtn" onclick="navigate(1)">›</button>
    </div>
</div>

<div class="install-banner" id="installBanner">
    <div class="install-icon">AQ7</div>
    <div class="install-text">
        <strong>Add to Home Screen</strong>
        <span>Quick access to your fav vids</span>
    </div>
    <button class="install-btn" id="installBtn">Install</button>
    <button class="install-close" onclick="dismissInstall()">✕</button>
</div>

<script>
'use strict';

const videos = ["VID67.mp4","VID8.mp4","VID19.mp4","VID9.mp4","VID5.mp4","VID110.mp4","VID7.mp4","VID2.mp4","VID4.mp4","VID10.mp4","VID11.mp4","VID12.mp4","VID13.mp4","VID14.mp4","VID15.mp4","VID16.mp4","VID17.mp4","VID18.mp4","VID3.mp4","VID20.mp4","VID21.mp4","VID22.mp4","VID23.mp4","VID24.mp4","VID25.mp4","VID26.mp4","VID27.mp4","VID28.mp4","VID29.mp4","VID30.mp4","VID31.mp4","VID32.mp4","VID33.mp4","VID34.mp4","VID35.mp4","VID36.mp4","VID37.mov","VID38.mp4","VID39.mp4","VID40.mp4","VID41.mp4","VID42.mp4","VID43.mp4","VID44.mp4","VID45.mp4","VID46.mp4","VID47.mp4","VID48.mp4","VID49.mp4","VID50.mp4","VID51.mp4","VID52.mp4","VID53.mp4","VID54.mp4","VID55.mp4","VID56.mp4","VID57.mp4","VID58.mp4","VID59.mp4","VID60.mp4","VID61.mp4","VID62.mp4","VID63.mp4","VID64.mp4","VID65.mp4","VID66.mp4","VID1.mp4","VID68.mp4","VID69.mp4","VID70.mp4","VID71.mp4","VID72.mp4","VID73.mp4","VID74.mp4","VID75.mp4","VID76.mp4","VID77.mp4","VID78.mp4","VID79.mp4","VID80.mp4","VID81.mp4","VID82.mp4","VID83.mp4","VID84.mp4","VID85.mp4","VID86.mp4","VID87.mp4","VID88.mp4","VID89.mp4","VID90.mp4","VID91.mp4","VID92.mp4","VID93.mp4","VID94.mp4","VID95.mp4","VID96.mp4","VID97.mp4","VID98.mp4","VID99.mp4","VID100.mp4","VID101.mp4","VID102.mp4","VID103.mp4","VID104.mov","VID105.mp4","VID106.mp4","VID107.mp4","VID108.mov","VID109.mp4","VID6.mp4","VID111.mp4","VID112.mp4","VID113.mp4","VID114.mp4","VID115.mp4","VID116.mp4","VID117.mp4","VID118.mp4","VID119.mp4","VID120.mp4","VID121.mp4","VID122.mp4","VID123.mp4","VID124.mp4","VID125.mp4","VID126.mp4","VID127.mp4","VID128.mp4","VID129.mp4","VID130.mp4","VID131.mp4","VID132.mp4","VID133.mp4","VID134.mp4","VID135.mp4","VID136.mp4","VID137.mp4","VID138.mp4","VID139.mp4","VID140.mp4","VID141.mp4","VID142.mp4","VID143.mp4","VID144.mp4","VID145.mp4","VID146.mp4","VID147.mp4","VID148.mp4","VID149.mp4","VID150.mp4","VID151.mp4","VID152.mp4","VID153.mp4","VID154.mp4","VID155.mp4","VID156.mp4","VID157.mp4","VID158.mp4","VID159.mp4","VID160.mp4","VID161.mp4","VID162.mp4","VID163.mp4","VID164.mp4","VID165.mp4","VID166.mp4","VID167.mp4","VID168.mp4","VID169.mp4","VID170.mp4","VID171.mp4","VID172.mp4","VID173.mp4","VID174.mp4","VID175.mp4","VID176.mp4","VID177.mp4","VID178.mp4","VID179.mp4","VID180.mp4","VID181.mp4","VID182.mp4","VID183.mp4","VID184.mp4","VID185.mp4","VID186.mp4","VID187.mp4","VID188.mp4","VID189.mp4","VID190.mp4","VID191.mp4","VID192.mp4","VID193.mp4","VID194.mp4","VID195.mp4","VID196.mp4","VID197.mp4","VID198.mp4","VID199.mp4","VID200.mp4","VID201.mp4","VID202.mp4","VID203.mp4","VID204.mp4","VID205.mp4","VID206.mp4","VID207.mp4","VID208.mp4","VID209.mp4","VID210.mp4","VID211.mp4","VID212.mp4","VID213.mp4","VID214.mp4","VID215.mp4","VID216.mp4","VID217.mp4","VID218.mp4"];

// STATE
let currentIndex = -1;
let playMode = 'replay';
let rafId = null;
let deferredInstall = null;

const vid = document.getElementById('modalVideo');
const modal = document.getElementById('modalOverlay');
const counter = document.getElementById('modalCounter');
const tapHint = document.getElementById('tapHint');
const tapCircle = document.getElementById('tapCircle');
const progressBar = document.getElementById('progressBar');

// GRID — paginated, zero video elements
const PAGE = 30;
let rendered = 0;

function renderPage() {
    const grid = document.getElementById('videoGrid');
    const frag = document.createDocumentFragment();
    const end = Math.min(rendered + PAGE, videos.length);
    for (let i = rendered; i < end; i++) {
        const base = videos[i].replace(/\.(mp4|mov)$/i, '');
        const d = document.createElement('div');
        d.className = 'video-thumb';
        d.innerHTML =
            '<div class="thumb-bg"></div>' +
            '<img class="thumb-img" loading="lazy" src="thumb_' + base + '.jpg" alt="">' +
            '<div class="thumb-overlay"></div>' +
            '<div class="thumb-play-icon"></div>' +
            '<div class="thumb-num">#' + String(i + 1).padStart(3, '0') + '</div>';
        d.onclick = () => openModal(i);
        frag.appendChild(d);
    }
    grid.appendChild(frag);
    rendered = end;
}



new IntersectionObserver(([e]) => {
    if (e.isIntersecting && rendered < videos.length) renderPage();
}, { rootMargin: '400px' }).observe(document.getElementById('sentinel'));

renderPage();


// MODAL
function openModal(index) {
    currentIndex = index;
    modal.classList.add('open');
    document.body.style.overflow = 'hidden';
    loadVideo(index);
    updateNav();
}

function closeModal() {
    vid.pause();
    vid.removeAttribute('src');
    vid.load();
    modal.classList.remove('open');
    document.body.style.overflow = '';
    stopRaf();
    progressBar.style.width = '0%';
    setHint(true, false);
}

function loadVideo(index) {
    stopRaf();
    progressBar.style.width = '0%';
    setHint(true, false);
    counter.textContent = '#' + String(index + 1).padStart(3, '0') + ' / ' + videos.length;

    // Fully reset video element — critical for iOS
    vid.pause();
    vid.removeAttribute('src');
    vid.load();

    // Small timeout lets iOS flush the old video before assigning new src
    setTimeout(() => {
        vid.src = videos[index];
        vid.loop = (playMode === 'replay');
        vid.load();

        const p = vid.play();
        if (p) {
            p.then(() => {
                setHint(false, false);
                startRaf();
            }).catch(() => {
                setHint(true, false);
            });
        }
    }, 50);
}

function togglePlay() {
    if (vid.paused) {
        vid.play().then(() => {
            setHint(false, false);
            startRaf();
        }).catch(() => {});
    } else {
        vid.pause();
        setHint(true, true);
        stopRaf();
    }
}

function setHint(show, paused) {
    tapHint.classList.toggle('show', show);
    tapCircle.classList.toggle('paused', paused);
}

function startRaf() {
    stopRaf();
    const tick = () => {
        if (vid.duration) {
            progressBar.style.width = (vid.currentTime / vid.duration * 100) + '%';
        }
        rafId = requestAnimationFrame(tick);
    };
    rafId = requestAnimationFrame(tick);
}

function stopRaf() {
    if (rafId) { cancelAnimationFrame(rafId); rafId = null; }
}

vid.addEventListener('ended', () => {
    if (playMode === 'autoNext') navigate(1);
});

vid.addEventListener('play', () => { setHint(false, false); startRaf(); });
vid.addEventListener('pause', () => {
    // Don't show hint on brief internal pauses (src change etc)
    if (vid.readyState > 0 && !vid.ended) {
        setHint(true, true);
        stopRaf();
    }
});

// Tapping the video itself also toggles
vid.addEventListener('click', togglePlay);

function navigate(dir) {
    const next = currentIndex + dir;
    if (next < 0 || next >= videos.length) return;
    currentIndex = next;
    loadVideo(next);
    updateNav();
}

function updateNav() {
    document.getElementById('prevBtn').disabled = currentIndex <= 0;
    document.getElementById('nextBtn').disabled = currentIndex >= videos.length - 1;
}

// SWIPE
let tx = 0, ty = 0, moved = false;
modal.addEventListener('touchstart', e => { tx = e.touches[0].clientX; ty = e.touches[0].clientY; moved = false; }, { passive: true });
modal.addEventListener('touchmove', () => { moved = true; }, { passive: true });
modal.addEventListener('touchend', e => {
    if (!moved) return;
    const dx = e.changedTouches[0].clientX - tx;
    const dy = e.changedTouches[0].clientY - ty;
    const ax = Math.abs(dx), ay = Math.abs(dy);
    if (dy > 80 && ay > ax) { closeModal(); return; }
    if (ax > 55 && ax > ay) navigate(dx < 0 ? 1 : -1);
}, { passive: true });

// KEYBOARD
document.addEventListener('keydown', e => {
    if (!modal.classList.contains('open')) return;
    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') navigate(1);
    else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') navigate(-1);
    else if (e.key === 'Escape') closeModal();
    else if (e.key === ' ') { e.preventDefault(); togglePlay(); }
});

// VISIBILITY — pause/resume when app goes background
document.addEventListener('visibilitychange', () => {
    if (!modal.classList.contains('open')) return;
    if (document.hidden) {
        vid.pause();
    } else {
        vid.play().then(() => { setHint(false, false); startRaf(); }).catch(() => setHint(true, false));
    }
}, { passive: true });

window.addEventListener('pageshow', e => {
    if (e.persisted && modal.classList.contains('open')) vid.play().catch(() => {});
}, { passive: true });

// MODE
function setMode(mode) {
    playMode = mode;
    document.getElementById('replayBtn').classList.toggle('active', mode === 'replay');
    document.getElementById('autoNextBtn').classList.toggle('active', mode === 'autoNext');
    vid.loop = (mode === 'replay');
}

// PWA MANIFEST
const manifest = { name:"AQ7 FAV", short_name:"AQ7 FAV", start_url:"./", display:"standalone", background_color:"#0a0a0a", theme_color:"#0a0a0a", orientation:"portrait", icons:[{src:"icon-192.png",sizes:"192x192",type:"image/png"},{src:"icon-512.png",sizes:"512x512",type:"image/png"}] };
document.getElementById('manifestLink').href = URL.createObjectURL(new Blob([JSON.stringify(manifest)], { type: 'application/json' }));

// INSTALL
window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault(); deferredInstall = e;
    setTimeout(() => document.getElementById('installBanner').classList.add('show'), 3000);
});
document.getElementById('installBtn').onclick = async () => {
    if (!deferredInstall) return;
    deferredInstall.prompt();
    const { outcome } = await deferredInstall.userChoice;
    if (outcome === 'accepted') dismissInstall();
};
function dismissInstall() { document.getElementById('installBanner').classList.remove('show'); }
window.addEventListener('appinstalled', dismissInstall, { passive: true });
</script>
</body>
</html>